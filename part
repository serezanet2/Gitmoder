local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local StarterGui = game:GetService("StarterGui")

-- Удаляем стандартный Tab, если он есть
StarterGui:SetCoreGuiEnabled(Enum.CoreGuiType.PlayerList, false)

-- Создаем UI элементы
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- Удаляем старый кастомный Tab, если он существует
local oldCustomTab = playerGui:FindFirstChild("CustomTab")
if oldCustomTab then
    oldCustomTab:Destroy()
end

-- Создаем новый ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "CustomTab"
screenGui.ResetOnSpawn = false
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
screenGui.Parent = playerGui

-- Основной контейнер
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0.2, 0, 0.6, 0)
mainFrame.Position = UDim2.new(0.78, 0, 0.2, 0)
mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
mainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
mainFrame.BackgroundTransparency = 0.2
mainFrame.BorderSizePixel = 0
mainFrame.ClipsDescendants = true

-- Скругление углов
local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0.05, 0)
corner.Parent = mainFrame

mainFrame.Parent = screenGui

-- Заголовок
local header = Instance.new("Frame")
header.Name = "Header"
header.Size = UDim2.new(1, 0, 0.08, 0)
header.Position = UDim2.new(0, 0, 0, 0)
header.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
header.BorderSizePixel = 0
header.Parent = mainFrame

local headerCorner = Instance.new("UICorner")
headerCorner.CornerRadius = UDim.new(0.05, 0)
headerCorner.Parent = header

local headerText = Instance.new("TextLabel")
headerText.Name = "HeaderText"
headerText.Size = UDim2.new(1, 0, 1, 0)
headerText.Position = UDim2.new(0, 0, 0, 0)
headerText.BackgroundTransparency = 1
headerText.Text = "Игроки"
headerText.TextColor3 = Color3.fromRGB(255, 255, 255)
headerText.TextScaled = true
headerText.Font = Enum.Font.GothamBold
headerText.Parent = header

-- Контейнер для списка игроков
local scrollFrame = Instance.new("ScrollingFrame")
scrollFrame.Name = "ScrollFrame"
scrollFrame.Size = UDim2.new(1, 0, 0.92, 0)
scrollFrame.Position = UDim2.new(0, 0, 0.08, 0)
scrollFrame.BackgroundTransparency = 1
scrollFrame.BorderSizePixel = 0
scrollFrame.ScrollBarThickness = 5
scrollFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
scrollFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
scrollFrame.Parent = mainFrame

local listLayout = Instance.new("UIListLayout")
listLayout.Name = "ListLayout"
listLayout.Padding = UDim.new(0.01, 0)
listLayout.SortOrder = Enum.SortOrder.LayoutOrder
listLayout.Parent = scrollFrame

-- Функция для создания элемента игрока
local function createPlayerEntry(player)
    local entry = Instance.new("Frame")
    entry.Name = player.Name
    entry.Size = UDim2.new(1, -10, 0.1, 0)
    entry.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    entry.BackgroundTransparency = 0.5
    entry.BorderSizePixel = 0
    entry.LayoutOrder = player.UserId
    entry.Parent = scrollFrame
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0.05, 0)
    corner.Parent = entry
    
    local avatar = Instance.new("ImageLabel")
    avatar.Name = "Avatar"
    avatar.Size = UDim2.new(0.8, 0, 0.8, 0)
    avatar.Position = UDim2.new(0.05, 0, 0.1, 0)
    avatar.BackgroundTransparency = 1
    avatar.Parent = entry
    
    -- Загружаем аватар
    local userId = player.UserId
    local thumbType = Enum.ThumbnailType.HeadShot
    local thumbSize = Enum.ThumbnailSize.Size100x100
    local content, isReady = Players:GetUserThumbnailAsync(userId, thumbType, thumbSize)
    
    if isReady then
        avatar.Image = content
    else
        avatar.Image = "rbxassetid://0" -- Заглушка, если аватар не загрузился
    end
    
    local nameLabel = Instance.new("TextLabel")
    nameLabel.Name = "NameLabel"
    nameLabel.Size = UDim2.new(0.6, 0, 0.5, 0)
    nameLabel.Position = UDim2.new(0.3, 0, 0.25, 0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Text = player.Name
    nameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    nameLabel.TextXAlignment = Enum.TextXAlignment.Left
    nameLabel.TextScaled = true
    nameLabel.Font = Enum.Font.Gotham
    nameLabel.Parent = entry
    
    return entry
end

-- Обновляем список игроков
local function updatePlayerList()
    for _, child in ipairs(scrollFrame:GetChildren()) do
        if child:IsA("Frame") and child.Name ~= "UIListLayout" then
            child:Destroy()
        end
    end
    
    for _, player in ipairs(Players:GetPlayers()) do
        createPlayerEntry(player)
    end
end

-- Обработчики событий
Players.PlayerAdded:Connect(function(player)
    createPlayerEntry(player)
end)

Players.PlayerRemoving:Connect(function(player)
    local entry = scrollFrame:FindFirstChild(player.Name)
    if entry then
        entry:Destroy()
    end
end)

-- Инициализация
updatePlayerList()
